<!-- $Id: document.html,v 1.1 2005/07/26 19:41:50 Lushe Exp $ -->
<html>
<head>
<tmpl_ex hidden=1>
  $_[1]->{page_title}= "Document.";
  $_[1]->{amazon_max_disp}= 28;
</tmpl_ex>
<tmpl_include name="html-header.tmpl">
</head>
<body>

<tmpl_include name="page-header.tmpl">

<div class="adsLinkTop">
<tmpl_include name=ads-link-120-90.tmpl>
</div>

<div class="pageInfo" style="left:150">
 <h1 class="pageTitle"><tmpl_var name="page_title"></h1>
</div>

<div style="clear:both; float:left;">
<tmpl_include name=amazon-disp.tmpl>
</div>

<div class="mainBody">

<div class="contents">
<h2 class="topic2">Contents</h2>
<ul>
<li><a href="#NAME">NAME</a></li>
<li><a href="#SYNOPSIS">SYNOPSIS</a></li>
<li><a href="#DESCRIPTION">DESCRIPTION</a>
 <ul>
 <li><a href="#tmpl_ex">&lt;tmpl_ex> ... &lt;/tmpl_ex></a></li>
 <li><a href="#tmpl_set">&lt;tmpl_set name='...' value='...'></a></li>
 <li><a href="#tmpl_env">&lt;tmpl_var name='env_*[ Environment variable name. ]'></a></li>
 </ul>
</li>
<li><a href="#METHOD">METHOD</a>
 <ul>
 <li><a href="#new">new</a></li>
 <li><a href="#charset">charset</a></li>
 <li><a href="#other">other</a></li>
 </ul>
</li>
<li><a href="#NOTES">NOTES</a></li>
<li><a href="#WARNING">WARNING</a></li>
<li><a href="#BUGS">BUGS</a></li>
<li><a href="#SEEALSO">SEEALSO</a></li>
<li><a href="#COPYRIGHT">COPYRIGHT</a></li>
<li><a href="#AUTHOR">AUTHOR</a></li>
</ul>
</div>

<a name="NAME"></a>
<h2 class="topic2">
<a href="#pagetop"><img src="/img/ptop.gif" width="15" height="15" align="absmiddle"></a>
NAME
</h2>

<p>HTML::Template::Ex - The Perl code is executed in HTML::Template.</p>

<a name="SYNOPSIS"></a>
<h2 class="topic2">
<a href="#pagetop"><img src="/img/ptop.gif" width="15" height="15" align="absmiddle"></a>
SYNOPSIS
</h2>

<pre class="code">
package MyProject;
use CGI;
use Jcode;
use HTML::Template::Ex;

my $cgi = CGI->new;
my $self= bless { cgi=> cgi }, __PACKAGE__;

my $template= <<END_OF_TEMPLATE;
&lt;html>
&lt;head>&lt;title>&lt;tmpl_var name="title"&gt;&lt;/title>&lt;/head>
&lt;body>
&lt;tmpl_set name="title" value="HTML::Template::Ex">

&lt;h1>&lt;tmpl_var name="page_title">&lt;/h1>

&lt;div style="margin:10; background:#DDD;">
&lt;tmpl_ex>
	my($self, $param)= @_;
	$param->{page_title}= 'My Page Title';
	return $self->{cgi}->param('name') || 'It doesn't receive it.';
&lt;/tmpl_ex>
&lt;/div>

&lt;div style="margin:10; background:#DDD;">
&lt;tmpl_loop name="users">
  &lt;div>
  &lt;tmpl_var name="u_name" escape="html">
  : &lt;tmpl_var name="email" escape="html">
  &lt;/div>
&lt;/tmpl_loop>
&lt;/div>

&lt;tmpl_ex name="users">
return [
 { u_name=> 'foo', email=> 'foo@mydomain'    },
 { u_name=> 'boo', email=> 'boo@localdomain' },
 ];
&lt;/tmpl_ex>

&lt;tmpl_var name="env_remote_addr">

&lt;body>&lt;/html>
END_OF_TEMPLATE

my $tmpl= HTML::Template::Ex->new($self, {
  setup_env=> 1,
  scalarref=> \$template,
  encoder  => sub { Jcode->new($_[0])->euc },
  # ... other 'HTML::Template' options.
  });

print STDOUT $cgi->header, $tmpl->output;
</pre>

<a name="DESCRIPTION"></a>
<h2 class="topic2">
<a href="#pagetop"><img src="/img/ptop.gif" width="15" height="15" align="absmiddle"></a>
DESCRIPTION
</h2>

<a name="tmpl_ex"></a>
<h3 class="topic3">&lt;tmpl_ex> ... &lt;/tmpl_ex> (EX-Code)</h3>

<ul style="width:75%;">
<p>The character string enclosed with &lt;tmpl_ex> ... &lt;/tmpl_ex> (Hereafter, it is written as EX-Code) is evaluated as Perl code and executed.</p>

<li>
The HASH reference for the definition of the parameter of the object and the template of the first argument given to the constructor of HTML::Template::Ex is passed to the code. 
The value substituted for the HASH for the parameter definition can be referred to by using &lt;tmpl_var *NAME>.
</li>

<p>
<b>Example of template.</b>
<pre class="code">
&lt;tmpl_ex>
  my($self, $param)= @_;
  $param->{banban}= '&lt;b>banban&lt;/b>';
  "My Object = ". ref($self)
&lt;/tmpl_ex>
--- &lt;tmpl_var name="banban"> ---
</pre>

<b>When you do output.</b>
<pre class="code">
My Object = *OBJECT-NAME
--- &lt;b>banban&lt;/b> ---
</pre>
</p>

<li>
If the return value of the code is an array and doesn't exist, &lt;tmpl_var *NAME> to bury the return value under the position is put.
</li>

<p>
<b>Example of template.</b>
<pre class="code">
&lt;tmpl_ex> "&lt;h1>result string.&lt;/h1>"; &lt;/tmpl_ex>
</pre>

<b>When you do output.</b>
<pre class="code">
&lt;h1>result string.&lt;/h1>
</pre>
</p>

<li>
The name of the variable for which the return value of the code is substituted can be specified. 
<br>Please use and refer to &lt;tmpl_var *NAME> for the substituted value.
</li>

<p>
<b>Example of template.</b>
<pre class="code">
&lt;tmpl_ex name="foge"> "&lt;b>result string.&lt;/b>"; &lt;/tmpl_ex>
--- &lt;tmpl_var name="foge"> ---
</pre>

<b>When you do output.</b>
<pre class="code">
&lt;b>result string.&lt;/b>
--- &lt;b>result string.&lt;/b> ---
</pre>
</p>

<li>
When the thing that the return value is buried under the position is not hoped as stated above, the hidden option is made effective. 
</li>

<p>
<b>Example of template.</b>
<pre class="code">
&lt;tmpl_ex name="foge" hidden="1"> "&lt;b>result string.&lt;/b>"; &lt;/tmpl_ex>
--- &lt;tmpl_var name="foge"> ---
</pre>

<b>When you do output.</b>
<pre class="code">
--- &lt;b>result string.&lt;/b> ---
</pre>
</p>

<li>
When the code returns the ARRAY reference, it substitutes for the parameter specified by the name option and it ends.
Please use and refer to &lt;tmpl_loop *NAME> for this value. 
</li>

<p>
<b>Example of template.</b>
<pre class="code">
&lt;tmpl_ex name="array">
  my @array= ({ name=> 'name1' }, { name=> 'name2' });
  return \@array;
&lt;/tmpl>
&lt;tmpl_loop>&lt;div>name: &lt;tmpl_var name="name">&lt;/div>&lt;/tmpl_loop>
</pre>

<b>When you do output.</b>
<pre class="code">
&lt;div>name: name1&lt;/div>
&lt;div>name: name2&lt;/div>
</pre>
</p>

<li>
The 'escape' option to hand to HTML::Template to output it after it escapes in the return value of the code can be specified.
</li>

<p>
<b>Example of template.</b>
<pre class="code">
&lt;tmpl_ex escape="html"> "&lt;h1>result string.&lt;/h1>"; &lt;/tmpl_ex>
</pre>

<b>When you do output.</b>
<pre class="code">
&lt;result string.&gt;
</pre>
</p>

</ul>

<a name="tmpl_set"></a>
<h3 class="topic3">&lt;tmpl_set name='...' value='...'></h3>

<ul style="width:75%;">
<p>
The parameter value of the template inside can be set with &lt;tmpl_set name='...' value='...'>.
</p>

<p>
<b>Example of template.</b>
<pre class="code">
&lt;tmpl_set name="page_title" value="my page title">
&lt;h1>&lt;tmpl_var name="page_title">&lt;/h1>
</pre>

<b>When you do output.</b>
<pre class="code">
&lt;h1>my page title&lt;/h1>
</pre>
</p>
</ul>

<a name="tmpl_env"></a>
<h3 class="topic3">&lt;tmpl_var name='env_*[ Environment variable name. ]'></h3>

<ul style="width:75%;">
<p>
The parameter to call the environment variable when the 'setup_env' option is made effective when the constructor is called is prepared.
 To refer to the prepared value, the name of the environment variable that wants to refer following env_ is specified.
</p>

<p>
<b>Example of template.</b>
<pre class="code">
&lt;div>HTTP_REFERER: &lt;tmpl_var name="env_http_referer">&lt;/div>
&lt;div>REMOTE_ADDR : &lt;tmpl_var name="env_remote_addr">&lt;/div>
</pre>

<b>When you do output.</b>
<pre class="code">
&lt;div>HTTP_REFERER: http://....... &lt;/div>
&lt;div>REMOTE_ADDR : 0.0.0.0&lt;/div>
</pre>
</p>

</ul>

<a name="METHOD"></a>
<h2 class="topic2">
<a href="#pagetop"><img src="/img/ptop.gif" width="15" height="15" align="absmiddle"></a>
METHOD
</h2>

<ul style="width:75%;">

<a name="new"></a>
<h3 class="topic3">new</h3>

<p>
It is a constructor. <br>
Please pass in the first argument and pass the option to a suitable object and the second argument with HAHS reference.
</p>

<p>
<b>Example of code.</b>
<pre class="code">
my $self= bless {}, __PACKAGE__;
my $ex= HTML::Template::Ex
        -> new ($self, { filename=> 'foooo.tmpl', setup_env=> 1 });
</pre>
</p>

<h4>Parameter of option</h4>

<p>
Another for HTML::Template can specify the option to evaluate to following original HTML::Template::Ex in the option.
</p>

  <p><b>setup_env</b></p>
  ...  It is made to prepare of refer to the environment variable with &lt;tmpl_var *NAME>.

  <p><b>exec_off</b></p>
  ...  To invalidate EX-Code temporarily, it keeps effective.

  <p><b>exec_off</b></p>
  ...  The CODE reference to keep the character-code of the template to be constant can be defined.
  <p>* When the template made from a different character-code exists together, it finds it useful.</p>

<a name="charset"></a>
<h3 class="topic3">charset</h3>

<p>
The value can be referred to when charset can be acquired from &lt;meta ... content="text/html; charset=[Character set]"> in the template read. 
</p>

<a name="other"></a>
<h3 class="topic3">other</h3>

<p>
Other methods succeed the one of HTML::Template.
</p>

</ul>

<a name="NOTES"></a>
<h2 class="topic2">
<a href="#pagetop"><img src="/img/ptop.gif" width="15" height="15" align="absmiddle"></a>
NOTES
</h2>

<ul style="width:75%;">

<li style="margin-bottom:10; padding:5; border:#EEE solid 1px;">
About the option to give to the constructor.
<pre>
global_vars, compulsorily becomes effective.
die_on_bad_params, strict, file_cache, shared_cache, compulsorily becomes invalid.
It came to be able to specify cache from v0.03.
</pre>
</li>

<li style="margin-bottom:10; padding:5; border:#EEE solid 1px;">
About order by which EX-Code is evaluated.
<p>
This problem had been improved from v0.03 before though the processing order became complex when &lt;TMPL_INCLUDE *NAME> existed.
</p>
<p>
Processing is done in order of &lt;TMPL_EX>'s appearing regardless of the presence of &lt;TMPL_INCLUDE *NAME>.
</p>
</li>

<li style="margin-bottom:10; padding:5; border:#EEE solid 1px;">
Strict code is demanded EX-Code.  Otherwise, the error is output or even if the error is not output, the record will remain in the error log of HTTPD. 
</li>

<li style="margin-bottom:10; padding:5; border:#EEE solid 1px;">
There is no restriction in the Perl code that can be written in EX-Code.<br>
There is a possibility of causing an unpleasant situation because anything passes. <br>
When the code that especially accepts the input from the visitor is written, close attention is necessary for the user.<br>
Moreover, please do not write the code that does exit on the way. Because it doesn't understand what happens....<br>
Let's have it not put on the place where the template is seen from WEB though it is a thing that not is to saying as it....<br>
</li>

</ul>

<a name="WARNING"></a>
<h2 class="topic2">
<a href="#pagetop"><img src="/img/ptop.gif" width="15" height="15" align="absmiddle"></a>
WARNING
</h2>

<p style="width:75%;">
This module aims only at convenience, is made, and the thing concerning security is not considered. 
Please give enough security countermeasures on the project code side when actually using it. 
</p>


<a name="BUGS"></a>
<h2 class="topic2">
<a href="#pagetop"><img src="/img/ptop.gif" width="15" height="15" align="absmiddle"></a>
BUGS
</h2>

<p>When you find a bug, please email me (<a href="mailto:mizuno&#64;beeflag&#46;com">mizuno&#64;beeflag&#46;com</a>) with a light heart.</p>

<a name="SEEALSO"></a>
<h2 class="topic2">
<a href="#pagetop"><img src="/img/ptop.gif" width="15" height="15" align="absmiddle"></a>
SEE ALSO
</h2>

<p><a href="http://search.cpan.org/perldoc?HTML%3A%3ATemplate">HTML::Template</a>.</p>

<a name="COPYRIGHT"></a>
<h2 class="topic2">
<a href="#pagetop"><img src="/img/ptop.gif" width="15" height="15" align="absmiddle"></a>
COPYRIGHT
</h2>

<p>Copyright 2005 Bee Flag, Corp. &lt;<a href="http://beeflag.com/">http://beeflag.com/</a>&gt;, All Rights Reserved.</p>

<p>This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>


<a name="AUTHOR"></a>
<h2 class="topic2">
<a href="#pagetop"><img src="/img/ptop.gif" width="15" height="15" align="absmiddle"></a>
AUTHOR
</h2>

<p>Masatoshi Mizuno, <a href="mailto:mizuno&#64;beeflag&#46;com">mizuno&#64;beeflag&#46;com</a></p>

 <p></p>
 <div><tmpl_include name=ads-468-60.tmpl></div>
 <tmpl_include name="page-footer.tmpl">

</div>

</body>
</html>
